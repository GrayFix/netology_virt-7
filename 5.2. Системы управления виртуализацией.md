# 5.2. Системы управления виртуализацией

1. Сразу могу оговориться что у нас в компании при определении основной системы виртуализации мы выбрали Hyper-V. Т.к. у нас преимущественно все системы Windows, виртуализацию стали развивать когда уже появился Windows Server 2012 R2. Сценарии:
    1. 100 виртуальных машин на базе Linux и Windows, общие задачи. Варианты или VMWare или Hyper-V. Я за Hyper-V. Hyper-V имеет все необходимое для репликации их коробки. Резервное копирование можно использовать или встроенное, или любую коммерческую систему. Программные балансировщики можно использовать в виде виртуальных машин Linux или реализовать  средствами программы управления виртуальными машинами SC VMM. А средство управления ВМ при работе со 100 машинами точно потребуется.

    2. Opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин. По описанию больше подходит KVM с управлением на Proxmox. Но для Windows требуется соответствующее лицензирование.

    3. Можно использовать Microsoft Hyper-V Server. Но бесплатное решение для виртуализации Windows инфраструктуры звучит странно, т.к. Windows все равно требует лицензирования. И это лицензирование предполагает что можно использовать нормальные редакции Windows серверов.

    4. Рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux. Тут больше всего подойдет Vagrant, он в первую очередь для этого и создан. 

2. Для Windows Server 2012 и выше, а также Linux систем на ядрах поддерживающих Hyper-V все сводится к преобразованию или целиком виртуальной машины (через SCVMM например) или только дисков vmdk в vhd(x) с последующим созданием виртуальных машин для этих дисков. Если по каким-то причинам нет доступа напрямую к файлам ВМ или к экспорту ВМ из VMWare, можно пойти по пути создания образа при помощи загрузочного диска, с последующим восставновлением системы из этого образа на Hyper-V. Основные проблемы с подобными миграциями, это настройка сетевых интерфейсов. С другими компонентами проблем обычно не бывает, диски распознаются корректно и монтируются куда нужно (на Linux лучше монтировать по UUID или меткам).  
Для Windows Server 2008 нормальная поддержка Hyper-V появилась с 2008 R2. Лучше всего перед миграцией обновить до этой версии. Также потребуется установка компонентов интеграции Hyper-V.  
Для Windows Server 2003 потребуется соблюдение целого ряда условий для миграции. В первую очередь для нормальной работы дисковой подсистемы требуется установка стандартных драйверов Microsoft (нужно сделать до миграции), также можно заранее попробовать прописать в ОС драйвера для дисковой подсистемы Hyper-V. Обязательно потребуется установка компонентов интеграции Hyper-V. Лучше перед миграцией задать себе вопрос что проше перенсти систему или ОС.  
Для старых Linux машин, если есть модули для Hyper-V нужно обязательно их установить до миграции.  

3. Основные проблемы гетерогенных сред:
    - отдельные консоли управления (для VMWare или Hyper-V решается при помощи плагинов для VCenter и SCVMM, но это все равно не удобно);
    - проблемы миграции ВМ из одной среды в другую (только через простой);
    - проблемы резервного копирования и восстановления, из одной среды в другую;
    - для каждый среды нужно создавать свои наборы шаблонов для ВМ;
    - разные подходы к организации сети для ВМ, подачи дисков в ВМ, организации отказоустойчивости;
    - у каждой среды своя терминология и особенности использования, ведет к повышенным тратам на персонал;  
    - есть в принципе непереносимые машины, много вендоров делают образы только на VMWare;  
Если бы у меня был выбор, то конечно удобнее работать в одной среде. Но в реальном мире не получается. Если Windiws машин много, то для их виртуализации вполне хватает функционала Hyper-V, нет особого смысла приобретать VMWare, это просто дополнительные расходы т.к. стоимость лицензирования ОС внутри одинаковое, а для VMWare нужно еще доплатить сверху. Но с другой стороны, без VMWare в крупных инсталляциях не обойтись т.к. есть "замечательные" производители оборудования и ПО (например Cisco) у которых какие-то проблемы с образами для Hyper-V и они больше любят VMWare или KVM.  
Если много Linux серверов, то можно остановится на VMWare, для организаций с сильными специалистами можно расмотреть вариант на OpenStack.  
Для небольших инсталляцикй подходит Proxmox на базе KVM.